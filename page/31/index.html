<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


  <meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">

<script>
    (function(){
        if(''){
            let localStoragePasswdKey = '' + '_last_passwd';
            function checkPassword(password) {
                password = password == null ? null : password.trim();
                if (password !== '') {
                    if (password != null) {
                        // å¦‚æœç”¨æˆ·ç‚¹å‡»äº†ç¡®è®¤è€Œä¸”å¯†ç é”™è¯¯çš„æ—¶å€™, å› ä¸ºå½“password == nullçš„æ—¶å€™è¯´æ˜ç”¨æˆ·ç‚¹äº†å–æ¶ˆ
                        alert('Error!');
                    }
                    if (history.length > 1) {
                        history.back();
                    } else {
                        window.location.href = "about:blank";
                    }
                } else {
                    localStorage.setItem(localStoragePasswdKey, password);
                }
            }

            var password_verify_on_local = false;
            const hostname = window.location.hostname;
            if (password_verify_on_local || (!(hostname === "localhost" || hostname === "127.0.0.1" || hostname === "::1" || hostname.startsWith("192")))) {
                const lspk = localStorage.getItem(localStoragePasswdKey) || "";
                if (lspk !== '') {
                    var password = prompt('Open Sesame');
                    checkPassword(password);
                }
            }
        }
    })();
</script>








<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2">






<meta name="description" content="ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, &quot;hexo-theme-neo&quot;, click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari,">
<meta property="og:type" content="website">
<meta property="og:title" content="ğŸš™">
<meta property="og:url" content="https://hulinhong.com/page/31/index.html">
<meta property="og:site_name" content="ğŸš™">
<meta property="og:description" content="ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, &quot;hexo-theme-neo&quot;, click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari,">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ğŸš™">
<meta name="twitter:description" content="ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, &quot;hexo-theme-neo&quot;, click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari,">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":12,"scrollpercent":true,"onmobile":true,"dimmer":true,"body_content_height":0,"display_duration":150},
    local_search: {"enable":true,"trigger":"auto","top_n_per_article":1},
    fancybox: false,
    mediumzoom: true,
    darkmode_js: false,
    tabs: true,
    motion: {"enable":true,"async":false,"duration":188,"transition":{"header":"fadeIn","menu":"fadeIn","logo":"fadeIn","post_block_else":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeIn","footer":"fadeIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>








  <title>ğŸš™ - ğŸ’¨ ğŸ’¨ ğŸ’¨</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ğŸš™</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ğŸ’¨ ğŸ’¨ ğŸ’¨</p>
      
  </div>

  <div class="menu-item sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div class="menu-item site-search">
    
  
  <div class="site-search-div">
    <button class="search-icon" id="search-button">
      <i class="fa fa-search"></i>
    </button>
    <input type="text" id="local-search-input" class="st-search-input">
    <i id="local-search-close">Ã—</i>
  </div>


<script type="text/javascript" id="local.search.active">
    {/* var inputArea       = document.querySelector("#local-search-input");
    inputArea.onclick   = function(){ getSearchFile(); this.focus(); }
    inputArea.onkeydown = function(){ if(event.keyCode == 13) return false } */}
</script>



  </div>
  <div id="local-search-result-pc" class="local-search-result-cls"></div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

       
    </ul>
  

  
    
  
</nav>



 </div>
    </header>

    <div id="local-search-result-mobile" class="local-search-result-cls"></div>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/linux_gcc_builtin_expect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux_gcc_builtin_expect/" itemprop="url">GCCçš„åˆ†æ”¯é¢„æµ‹ä¼˜åŒ–__builtin_expect</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-04-11T12:26:26+00:00">
                04-11-2015
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          
            <h1 id="1-ä¸ºä»€ä¹ˆéœ€è¦åˆ†æ”¯é¢„æµ‹ä¼˜åŒ–"><a href="#1-ä¸ºä»€ä¹ˆéœ€è¦åˆ†æ”¯é¢„æµ‹ä¼˜åŒ–" class="headerlink" title="1. ä¸ºä»€ä¹ˆéœ€è¦åˆ†æ”¯é¢„æµ‹ä¼˜åŒ–"></a>1. ä¸ºä»€ä¹ˆéœ€è¦åˆ†æ”¯é¢„æµ‹ä¼˜åŒ–</h1><p> å°†æµæ°´çº¿å¼•å…¥cpuï¼Œå¯ä»¥æé«˜cpuçš„æ•ˆç‡ã€‚æ›´ç®€å•çš„è¯´ï¼Œè®©cpuå¯ä»¥é¢„å…ˆå–å‡ºä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œå¯ä»¥æä¾›cpuçš„æ•ˆç‡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>å–æŒ‡ä»¤</th>
<th>æ‰§è¡ŒæŒ‡ä»¤</th>
<th>è¾“å‡ºç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>å–æŒ‡ä»¤</td>
<td>æ‰§è¡Œ</td>
</tr>
</tbody>
</table>
<p>å¯è§ï¼Œcpuæµæ°´é’±å¯ä»¥å‡å°‘cpuç­‰å¾…å–æŒ‡ä»¤çš„è€—æ—¶ï¼Œä»è€Œæé«˜cpuçš„æ•ˆç‡ã€‚<br>å¦‚æœå­˜åœ¨è·³è½¬æŒ‡ä»¤ï¼Œé‚£ä¹ˆé¢„å…ˆå–å‡ºçš„æŒ‡ä»¤å°±æ— ç”¨äº†ã€‚cpuåœ¨æ‰§è¡Œå½“å‰æŒ‡ä»¤æ—¶ï¼Œä»å†…å­˜ä¸­å–å‡ºäº†å½“å‰æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚æ‰§è¡Œå®Œå½“å‰æŒ‡ä»¤åï¼Œcpuå‘ç°ä¸æ˜¯è¦æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤,è€Œæ˜¯æ‰§è¡Œoffsetåç§»å¤„çš„æŒ‡ä»¤ã€‚cpuåªèƒ½é‡æ–°ä»å†…å­˜ä¸­å–å‡ºoffsetåç§»å¤„çš„æŒ‡ä»¤ã€‚å› æ­¤ï¼Œè·³è½¬æŒ‡ä»¤ä¼šé™ä½æµæ°´çº¿çš„æ•ˆç‡ï¼Œä¹Ÿå°±æ˜¯é™ä½cpuçš„æ•ˆç‡ã€‚</p>
<p>ç»¼ä¸Šï¼Œåœ¨å†™ç¨‹åºæ—¶åº”è¯¥å°½é‡é¿å…è·³è½¬è¯­å¥ã€‚é‚£ä¹ˆå¦‚ä½•é¿å…è·³è½¬è¯­å¥å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ä½¿ç”¨__builtin_expectã€‚</p>
<p>è¿™ä¸ªæŒ‡ä»¤æ˜¯gccå¼•å…¥çš„ï¼Œä½œç”¨æ˜¯â€å…è®¸ç¨‹åºå‘˜å°†æœ€æœ‰å¯èƒ½æ‰§è¡Œçš„åˆ†æ”¯å‘Šè¯‰ç¼–è¯‘å™¨â€ã€‚</p>
<p>è¿™ä¸ªæŒ‡ä»¤çš„å†™æ³•ä¸ºï¼š<strong>builtin_expect(EXP, N)ã€‚æ„æ€æ˜¯ï¼šEXP==Nçš„æ¦‚ç‡å¾ˆå¤§ã€‚ä¸€èˆ¬çš„ä½¿ç”¨æ–¹æ³•æ˜¯å°†</strong>builtin_expectæŒ‡ä»¤å°è£…ä¸ºLIKELYå’ŒUNLIKELYå®ã€‚è¿™ä¸¤ä¸ªå®çš„å†™æ³•å¦‚ä¸‹ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LIKELY(x) __builtin_expect(!!(x), 1) <span class="comment">//xå¾ˆå¯èƒ½ä¸ºçœŸ</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> UNLIKELY(x) __builtin_expect(!!(x), 0) <span class="comment">//xå¾ˆå¯èƒ½ä¸ºå‡</span></span></span><br></pre></td></tr></table></figure>
<p>åœ¨å¾ˆå¤šæºç å¦‚Linuxå†…æ ¸ã€Glibç­‰,æˆ‘ä»¬éƒ½èƒ½çœ‹åˆ°likely()å’Œunlikely()è¿™ä¸¤ä¸ªå®,é€šå¸¸è¿™ä¸¤ä¸ªå®å®šä¹‰æ˜¯ä¸‹é¢è¿™æ ·çš„å½¢å¼ã€‚<br>å¯ä»¥çœ‹å‡ºè¿™2ä¸ªå®éƒ½æ˜¯ä½¿ç”¨å‡½æ•° <strong>builtin_expect()å®ç°çš„, </strong>builtin_expect()å‡½æ•°æ˜¯GCCçš„ä¸€ä¸ªå†…å»ºå‡½æ•°(build-in function).</p>
<h1 id="2-å‡½æ•°å£°æ˜"><a href="#2-å‡½æ•°å£°æ˜" class="headerlink" title="2. å‡½æ•°å£°æ˜"></a>2. å‡½æ•°å£°æ˜</h1><p>å‡½æ•°__builtin_expect()æ˜¯GCC v2.96ç‰ˆæœ¬å¼•å…¥çš„, å…¶å£°æ˜å¦‚ä¸‹:</p>
<p><code>long __builtin_expect(long exp, long c);</code></p>
<h2 id="2-1-åŠŸèƒ½æè¿°"><a href="#2-1-åŠŸèƒ½æè¿°" class="headerlink" title="2.1. åŠŸèƒ½æè¿°"></a>2.1. åŠŸèƒ½æè¿°</h2><p>ç”±äºå¤§éƒ¨åˆ†ç¨‹åºå‘˜åœ¨åˆ†æ”¯é¢„æµ‹æ–¹é¢åšå¾—å¾ˆç³Ÿç³•ï¼Œæ‰€ä»¥GCC æä¾›äº†è¿™ä¸ªå†…å»ºå‡½æ•°æ¥å¸®åŠ©ç¨‹åºå‘˜å¤„ç†åˆ†æ”¯é¢„æµ‹.</p>
<p>ä½ æœŸæœ› exp è¡¨è¾¾å¼çš„å€¼ç­‰äºå¸¸é‡ c, çœ‹ c çš„å€¼, å¦‚æœ c çš„å€¼ä¸º0(å³æœŸæœ›çš„å‡½æ•°è¿”å›å€¼), é‚£ä¹ˆ æ‰§è¡Œ if åˆ†æ”¯çš„çš„å¯èƒ½æ€§å°, å¦åˆ™æ‰§è¡Œ else åˆ†æ”¯çš„å¯èƒ½æ€§å°(å‡½æ•°çš„è¿”å›å€¼ç­‰äºç¬¬ä¸€ä¸ªå‚æ•° exp).</p>
<p>GCCåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä¼šå°†å¯èƒ½æ€§æ›´å¤§çš„ä»£ç ç´§è·Ÿç€å‰é¢çš„ä»£ç ï¼Œä»è€Œå‡å°‘æŒ‡ä»¤è·³è½¬å¸¦æ¥çš„æ€§èƒ½ä¸Šçš„ä¸‹é™, è¾¾åˆ°ä¼˜åŒ–ç¨‹åºçš„ç›®çš„.</p>
<p>é€šå¸¸ï¼Œä½ ä¹Ÿè®¸ä¼šæ›´å–œæ¬¢ä½¿ç”¨ gcc çš„ä¸€ä¸ªå‚æ•° â€˜-fprofile-arcsâ€™ æ¥æ”¶é›†ç¨‹åºè¿è¡Œçš„å…³äºæ‰§è¡Œæµç¨‹å’Œåˆ†æ”¯èµ°å‘çš„å®é™…åé¦ˆä¿¡æ¯,ä½†æ˜¯å¯¹äºå¾ˆå¤šç¨‹åºæ¥è¯´,æ•°æ®æ˜¯å¾ˆéš¾æ”¶é›†çš„ã€‚</p>
<h2 id="2-2-å‚æ•°è¯¦è§£"><a href="#2-2-å‚æ•°è¯¦è§£" class="headerlink" title="2.2. å‚æ•°è¯¦è§£"></a>2.2. å‚æ•°è¯¦è§£</h2><ul>
<li><p>exp<br>  exp ä¸ºä¸€ä¸ªæ•´å‹è¡¨è¾¾å¼, ä¾‹å¦‚: (ptr != NULL)</p>
</li>
<li><p>c<br>  c å¿…é¡»æ˜¯ä¸€ä¸ªç¼–è¯‘æœŸå¸¸é‡, ä¸èƒ½ä½¿ç”¨å˜é‡</p>
</li>
</ul>
<h2 id="2-3-è¿”å›å€¼"><a href="#2-3-è¿”å›å€¼" class="headerlink" title="2.3. è¿”å›å€¼"></a>2.3. è¿”å›å€¼</h2><p>ã€€ã€€è¿”å›å€¼ç­‰äº ç¬¬ä¸€ä¸ªå‚æ•° exp</p>
<h2 id="2-4-ä½¿ç”¨æ–¹æ³•"><a href="#2-4-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="2.4. ä½¿ç”¨æ–¹æ³•"></a>2.4. ä½¿ç”¨æ–¹æ³•</h2><p>ä¸å…³é”®å­—ifä¸€èµ·ä½¿ç”¨.é¦–å…ˆè¦æ˜ç¡®ä¸€ç‚¹å°±æ˜¯ if (value) ç­‰ä»·äº if (__builtin_expert(value, x)), ä¸xçš„å€¼æ— å…³.</p>
<p>ä¾‹å­å¦‚ä¸‹:</p>
<p>ä¾‹å­1 : æœŸæœ› x == 0, æ‰€ä»¥æ‰§è¡Œfunc()çš„å¯èƒ½æ€§å°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (__builtin_expect(x, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    func();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">ã€€ã€€<span class="comment">//do someting</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å­2 : æœŸæœ› ptr !=NULLè¿™ä¸ªæ¡ä»¶æˆç«‹(1), æ‰€ä»¥æ‰§è¡Œfunc()çš„å¯èƒ½æ€§å°</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (__builtin_expect(ptr != <span class="literal">NULL</span>, <span class="number">1</span>))</span><br><span class="line">&#123;ã€€ã€€</span><br><span class="line">ã€€ã€€<span class="comment">//do something</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">ã€€ã€€func();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¾‹å­3 : å¼•è¨€ä¸­çš„likely()å’Œunlikely()å®</p>
<p>é¦–å…ˆ,çœ‹ç¬¬ä¸€ä¸ªå‚æ•°!!(x), ä»–çš„ä½œç”¨æ˜¯æŠŠ(x)è½¬å˜æˆâ€å¸ƒå°”å€¼â€, æ— è®º(x)çš„å€¼æ˜¯å¤šå°‘ !(x)å¾—åˆ°çš„æ˜¯trueæˆ–false, !!(x)å°±å¾—åˆ°äº†åŸå€¼çš„â€å¸ƒå°”å€¼â€</p>
<p>ä½¿ç”¨ likely() ï¼Œæ‰§è¡Œ if åé¢çš„è¯­å¥ çš„æœºä¼šæ›´å¤§ï¼Œä½¿ç”¨ unlikely()ï¼Œæ‰§è¡Œ else åé¢çš„è¯­å¥çš„æœºä¼šæ›´å¤§ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> likely(x)    __builtin_expect(!!(x), 1)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> unlikely(x)  __builtin_expect(!!(x), 0)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">char</span> *argv[], <span class="keyword">int</span> argc)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">int</span> a;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* Get the value from somewhere GCC can't optimize */</span></span><br><span class="line">   a = atoi (argv[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (unlikely (a == <span class="number">2</span>))</span><br><span class="line">ã€€ &#123;</span><br><span class="line">      a++;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">ã€€ &#123;</span><br><span class="line">ã€€ã€€  a--;</span><br><span class="line">ã€€ &#125;</span><br><span class="line">   <span class="built_in">printf</span> (<span class="string">"%d\n"</span>, a);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3-RATIONALE-åŸç†"><a href="#3-RATIONALE-åŸç†" class="headerlink" title="3. RATIONALE(åŸç†)"></a>3. RATIONALE(åŸç†)</h1><p>if else å¥å‹ç¼–è¯‘å, ä¸€ä¸ªåˆ†æ”¯çš„æ±‡ç¼–ä»£ç ç´§éšå‰é¢çš„ä»£ç ,è€Œå¦ä¸€ä¸ªåˆ†æ”¯çš„æ±‡ç¼–ä»£ç éœ€è¦ä½¿ç”¨JMPæŒ‡ä»¤æ‰èƒ½è®¿é—®åˆ°.</p>
<p>å¾ˆæ˜æ˜¾é€šè¿‡JMPè®¿é—®éœ€è¦æ›´å¤šçš„æ—¶é—´, åœ¨å¤æ‚çš„ç¨‹åºä¸­,æœ‰å¾ˆå¤šçš„if elseå¥å‹,åˆæˆ–è€…æ˜¯ä¸€ä¸ªæœ‰if elseå¥å‹çš„åº“å‡½æ•°,æ¯ç§’é’Ÿè¢«è°ƒç”¨å‡ ä¸‡æ¬¡,</p>
<p>é€šå¸¸ç¨‹åºå‘˜åœ¨åˆ†æ”¯é¢„æµ‹æ–¹é¢åšå¾—å¾ˆç³Ÿç³•, ç¼–è¯‘å™¨åˆä¸èƒ½ç²¾å‡†çš„é¢„æµ‹æ¯ä¸€ä¸ªåˆ†æ”¯,è¿™æ—¶JMPäº§ç”Ÿçš„æ—¶é—´æµªè´¹å°±ä¼šå¾ˆå¤§,</p>
<p>å‡½æ•° <code>__builtin_expert()</code> å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„.</p>

          
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/smart_pointer_note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/smart_pointer_note/" itemprop="url">æ™ºèƒ½æŒ‡é’ˆç¬”è®°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-04-11T12:26:26+00:00">
                04-11-2015
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Misc/" itemprop="url" rel="index">
                    <span itemprop="name">Misc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          
            <p>æœ‰äº›é”™è¯¯æ˜¯ç¼–è¯‘å™¨æŸ¥ä¸åˆ°çš„, è¿™ç§é”™è¯¯æ˜¯æœ€å¯æ€•çš„, å½“é¡¹ç›®å¤§äº†ä¹‹å,<br>å³ä½¿ç”¨ Valgrind ä¹Ÿå¾ˆéš¾å®šä½,<br>å› ä¸ºè£¸æŒ‡é’ˆåœ¨å›¢é˜Ÿåˆä½œä¸­ä½¿ç”¨å¾ˆå®¹æ˜“å¯¼è‡´å…¶ä»–æˆå‘˜å¿˜è®°é‡Šæ”¾æˆ–å¤šæ¬¡é‡Šæ”¾, æ‰€ä»¥åœ¨å›¢é˜Ÿåˆä½œä¸­ä¸€èˆ¬ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ. </p>
<p>è€Œæ™ºèƒ½æŒ‡é’ˆç”¨çš„ä¸å¥½, ç»“æœå¯èƒ½é€‚å¾—å…¶å.</p>
<p>æ‰€ä»¥æˆ‘ä»¬èŠä¸€ä¸‹æ™ºèƒ½æŒ‡é’ˆçš„å‡ ç‚¹æ³¨æ„äº‹é¡¹.</p>
<p>æ€»ç»“è‡ª C++ Primer.</p>
<h1 id="ä¸€ä¸ªç®€å•çš„åŒ…å«åˆ é™¤å™¨çš„ä¾‹å­æ¼”ç¤º"><a href="#ä¸€ä¸ªç®€å•çš„åŒ…å«åˆ é™¤å™¨çš„ä¾‹å­æ¼”ç¤º" class="headerlink" title="ä¸€ä¸ªç®€å•çš„åŒ…å«åˆ é™¤å™¨çš„ä¾‹å­æ¼”ç¤º"></a>ä¸€ä¸ªç®€å•çš„åŒ…å«åˆ é™¤å™¨çš„ä¾‹å­æ¼”ç¤º</h1><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">using</span> <span class="built_in">std</span>::bind;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>::placeholders;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">testBind</span><span class="params">( <span class="keyword">int</span>* a, <span class="keyword">int</span> b, <span class="keyword">int</span> c )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; *a + b + c &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> *a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	Foo() = <span class="keyword">default</span>;</span><br><span class="line">	Foo( <span class="keyword">const</span> Foo &amp; a )</span><br><span class="line">	&#123;</span><br><span class="line">		data = a.data;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"å¤åˆ¶æ„é€ "</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">print_sum</span><span class="params">( <span class="keyword">int</span> n1, <span class="keyword">int</span> n2 )</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; n1 + n2 &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> data = <span class="number">10</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//ç»‘å®šç±»æˆå‘˜å‡½æ•°ç”¨å¯¹è±¡çš„æŒ‡é’ˆ</span></span><br><span class="line">	Foo foo;</span><br><span class="line">	<span class="keyword">auto</span> f3 = <span class="built_in">std</span>::bind( &amp;Foo::print_sum, &amp;foo, <span class="number">95</span>, _1 );</span><br><span class="line">	f3( <span class="number">5</span> );</span><br><span class="line"></span><br><span class="line">	<span class="keyword">auto</span> check_testBind = <span class="built_in">std</span>::bind( testBind, <span class="built_in">std</span>::placeholders::_1, <span class="number">3</span>, <span class="number">9</span> );</span><br><span class="line">	<span class="keyword">int</span> * p = <span class="keyword">new</span> <span class="keyword">int</span>( <span class="number">7</span> );</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; check_testBind( p ) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">shared_ptr</span>&lt;<span class="keyword">int</span>&gt; pi( <span class="keyword">new</span> <span class="keyword">int</span>(),</span><br><span class="line">		check_testBind );</span><br><span class="line">	*pi = <span class="number">88</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">shared_ptr</span>&lt;<span class="keyword">int</span>&gt; pii( <span class="keyword">new</span> <span class="keyword">int</span>( <span class="number">12</span> ),</span><br><span class="line">		<span class="built_in">std</span>::bind( testBind, <span class="built_in">std</span>::placeholders::_1, <span class="number">32</span>, <span class="number">19</span> ) );</span><br><span class="line"></span><br><span class="line">	<span class="built_in">std</span>::function&lt; <span class="keyword">int</span>( <span class="keyword">int</span>* ) &gt; test_function_bind =</span><br><span class="line">		<span class="built_in">std</span>::bind( testBind, <span class="built_in">std</span>::placeholders::_1, <span class="number">331</span>, <span class="number">9</span> );</span><br><span class="line"></span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; <span class="string">"test_function_bind( p, 331, 9 ) = "</span> &lt;&lt; test_function_bind( p ) &lt;&lt; <span class="built_in">endl</span>;;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">shared_ptr</span>&lt;<span class="keyword">int</span>&gt; piii( <span class="keyword">new</span> <span class="keyword">int</span>( <span class="number">112</span> ),</span><br><span class="line">		test_function_bind );</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœ :</p>
<pre><code>100
119
7
347
test_function_bind( p, 331, 9 ) = 7
452
63
100
è¯·æŒ‰ä»»æ„é”®ç»§ç»­. . .
</code></pre><h1 id="æ™ºèƒ½æŒ‡é’ˆé™·é˜±"><a href="#æ™ºèƒ½æŒ‡é’ˆé™·é˜±" class="headerlink" title="æ™ºèƒ½æŒ‡é’ˆé™·é˜±"></a>æ™ºèƒ½æŒ‡é’ˆé™·é˜±</h1><p>æ™ºèƒ½æŒ‡é’ˆå¯ä»¥æä¾›å¯¹åŠ¨æ€åˆ†é…çš„å†…å­˜å®‰å…¨è€Œåˆæ–¹ä¾¿çš„ç®¡ç†ï¼Œä½†è¿™å»ºç«‹åœ¨æ­£ç¡®ä½¿ç”¨çš„<br>å‰æä¸‹ ã€‚ ä¸ºäº†æ­£ç¡®ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼Œæˆ‘ä»¬å¿…é¡»åšæŒä¸€äº›åŸºæœ¬è§„èŒƒ :</p>
<ul>
<li>ä¸ä½¿ç”¨ç›¸åŒçš„å†…ç½®æŒ‡é’ˆå€¼åˆå§‹åŒ–(æˆ– reset) å¤šä¸ªæ™ºèƒ½æŒ‡é’ˆ ã€‚</li>
<li>ä¸ delete get ( ) è¿” å›çš„æŒ‡é’ˆ ã€‚</li>
<li>ä¸ä½¿ç”¨ get () åˆå§‹åŒ–æˆ– reset å¦ ä¸€ ä¸ªæ™ºèƒ½æŒ‡é’ˆ ã€‚</li>
<li>å¦‚æœä½ ä½¿ç”¨ get () è¿” å›çš„æŒ‡é’ˆï¼Œè®°ä½å½“æœ€åä¸€ä¸ªå¯¹åº”çš„æ™ºèƒ½æŒ‡é’ˆé”€ æ¯ åï¼Œ ä½  çš„<br>æŒ‡ é’ˆå°± å˜ä¸ºæ—  æ•ˆ äº† ã€‚</li>
<li>å¦‚æœä½ ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„èµ„æºä¸æ˜¯ new åˆ†é…çš„å†…å­˜ ï¼Œ è®°ä½ä¼ é€’ç»™å®ƒä¸€ä¸ªåˆ é™¤<br>å™¨( å‚è§ 12. 1.4 èŠ‚ ï¼Œ ç¬¬ 415 é¡µå’Œ 12. 1.5 èŠ‚ ï¼Œ ç¬¬ 419 é¡µ)ã€‚</li>
</ul>
<h1 id="å°½é‡ç”¨make-sharedè€Œénew"><a href="#å°½é‡ç”¨make-sharedè€Œénew" class="headerlink" title="å°½é‡ç”¨make_sharedè€Œénew"></a>å°½é‡ç”¨make_sharedè€Œénew</h1><p>shared_ptr å¯ä»¥åè°ƒå¯¹è±¡çš„ææ„ ï¼Œ ä½†è¿™ä»…é™äºå…¶è‡ªèº«çš„æ‹·è´ ( ä¹Ÿ æ˜¯ shared_ptr)<br>ä¹‹é—´ã€‚</p>
<p><strong>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æ¨èä½¿ç”¨ make_shared è€Œä¸æ˜¯ new çš„åŸå›  ã€‚</strong></p>
<p><strong>è¿™æ · ï¼Œ æˆ‘ä»¬å°±èƒ½åœ¨åˆ†é…å¯¹è±¡çš„åŒæ—¶å°±å°† shared_ptr ä¸ä¹‹ç»‘å®šï¼Œ</strong><br><strong>ä»è€Œé¿å…äº†æ— æ„ä¸­å°†åŒä¸€å—å†…å­˜ç»‘å®šåˆ°å¤šä¸ªç‹¬ç«‹åˆ›å»ºçš„ shared_ptr ä¸Š ã€‚(è¿™æ˜¯æœ€å®¹æ˜“çŠ¯çš„é”™)</strong></p>
<p><strong>æ€»ç»“ : æ‰€ä»¥æˆ‘ä»¬è¦å°½é‡ä¸€å¼€å§‹å°±ç”¨make_sharedæ¥åˆ†é…åŠ¨æ€å†…å­˜, è€Œä¸æ˜¯å…ˆnewä¸€ä¸ªå‡ºæ¥, å†æ‰¾æœºä¼šå°†å®ƒè½¬ä¸ºæ™ºèƒ½æŒ‡é’ˆ.</strong></p>
<p>è€ƒè™‘ä¸‹é¢å¯¹ shared_ptr è¿›è¡Œæ“ä½œçš„å‡½æ•° :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åœ¨å‡½æ•°è¢«è°ƒç”¨æ—¶ ptr è¢«åˆ›å»ºå¹¶åˆå§‹åŒ–</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">process</span><span class="params">(<span class="built_in">shared_ptr</span>&lt;<span class="keyword">int</span>&gt; ptr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ ptr</span></span><br><span class="line">&#125; <span class="comment">// ptr ç¦» å¼€ä½œç”¨åŸŸï¼Œè¢«é”€æ¯</span></span><br></pre></td></tr></table></figure>
<p>process çš„å‚æ•°æ˜¯ä¼ å€¼æ–¹å¼ä¼ é€’çš„ï¼Œå› æ­¤å®å‚ä¼šè¢«æ‹·è´åˆ° ptr å·¾ ã€‚ æ‹·è´ ä¸€ ä¸ª shared_ptr<br>ä¼šé€’å¢å…¶å¼•ç”¨è®¨æ•°ï¼Œå› æ­¤ï¼Œ åœ¨ process è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¼•ç”¨ä¸ƒ| æ•°å€¼è‡³å°‘ä¸º 2 ã€‚ å½“ process<br>ç»“æŸæ—¶ï¼Œ ptr çš„å¼•ç”¨è®¡æ•°ä¼šè¾¹å–Šï¼Œä½†ä¸ä¼šå˜ä¸º 0 ã€‚ å› æ­¤ï¼Œå½“ç”¨éŸ³11å˜ 11 ptr è¢«é”€æ¯æ—¶ï¼Œ ptr<br>æŒ‡å‘çš„å†…å­˜ä¸ä¼šè¢«é‡Šæ”¾ ã€‚</p>
<p>ä½¿ç”¨æ­¤å‡½æ•°çš„æ­£ç¡®æ–¹æ³•æ˜¯ä¼ é€’ç»™å®ƒä¸€ä¸ª shared_ptr :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">shared_ptr</span>&lt;<span class="keyword">int</span>&gt; p(<span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">42</span>)) ; <span class="comment">// å¼•ç”¨è®¡æ•°ä¸º 1</span></span><br><span class="line">process(p); <span class="comment">// æ‹·è´ p ä¼šé€’å¢å®ƒçš„å¼•ç”¨è®¡æ•° ;åœ¨ process ä¸­å¼•ç”¨è®¡æ•°ä½ä¸º 2</span></span><br><span class="line"><span class="keyword">int</span> i = *p; <span class="comment">// æ­£ç¡®:å¼•ç”¨è®¡æ•°ä½ä¸º 1</span></span><br></pre></td></tr></table></figure>
<p>è™½ç„¶ä¸èƒ½ä¼ é€’ç»™ process ä¸€ ä¸ªå†…ç½®æŒ‡é’ˆï¼Œä½†å¯ä»¥ä¼ é€’ ç»™å®ƒ ä¸€ ä¸ª(ä¸´æ—¶çš„)<br>shared_ptr ï¼Œ è¿™ä¸ª shared_ptr æ˜¯ç”¨ ä¸€ä¸ªå†… ç½®æŒ‡é’ˆæ˜¾å¼æ„é€ çš„ ã€‚ ä½†æ˜¯ï¼Œè¿™æ ·åšå¾ˆå¯èƒ½<br>ä¼šå¯¼è‡´é”™è¯¯ :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">int *x(new int(1024)); // å±é™© x æ˜¯ä¸€ä¸ªæ™®é€šæŒ‡é’ˆï¼Œä¸æ˜¯ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆ</span><br><span class="line">process(x) ; <span class="comment">// é”™è¯¯ : ä¸èƒ½å°† int* è½¬æ¢ä¸º ä¸€ä¸ª shared_ptr&lt;int&gt;</span></span><br><span class="line">process(<span class="built_in">shared_ptr</span>&lt;<span class="keyword">int</span>&gt;(x)); <span class="comment">// åˆæ³•çš„ï¼Œä½†å†…å­˜ä¼šè¢«é‡Šæ”¾!</span></span><br><span class="line"><span class="keyword">int</span> j = *x ; <span class="comment">//æœªå®šä¹‰çš„ x æ˜¯ä¸€ä¸ªç©ºæ‚¬æŒ‡é’ˆ!</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„è°ƒç”¨ä¸­ ï¼Œ æˆ‘ä»¬å°†ä¸€ä¸ªä¸´æ—¶ shared_ptr ä¼ é€’ç»™ process ã€‚ å½“è¿™ä¸ªè°ƒç”¨æ‰€åœ¨çš„è¡¨<br>è¾¾å¼ç»“æŸæ—¶ï¼Œè¿™ä¸ªä¸´æ—¶å¯¹è±¡å°±è¢«é”€æ¯äº† ã€‚ é”€æ¯è¿™ä¸ªä¸´æ—¶å˜é‡ä¼šé€’å‡å¼•ç”¨è®¡æ•°ï¼Œæ­¤æ—¶å¼•ç”¨è®¡<br>æ•°å°±å˜ä¸º 0 äº† ã€‚ å› æ­¤ï¼Œå½“ä¸´æ—¶å¯¹è±¡è¢«é”€æ¯æ—¶ ï¼Œ å®ƒæ‰€æŒ‡å‘çš„å†…å­˜ä¼šè¢«é‡Šæ”¾ ã€‚<br>ä½† x ç»§ç»­æŒ‡ å‘ (å·²ç»é‡Šæ”¾çš„)å†…å­˜ï¼Œä»è€Œå˜æˆä¸€ä¸ªç©ºæ‚¬æŒ‡é’ˆã€‚å¦‚æœè¯•å›¾ä½¿ç”¨ x çš„å€¼ï¼Œ<br>å…¶è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ ã€‚</p>
<p>å½“å°†ä¸€ä¸ª shared_ptr ç»‘å®šåˆ°ä¸€ä¸ªæ™®é€šæŒ‡é’ˆæ—¶ ï¼Œ æˆ‘ä»¬å°±å°†å†…å­˜çš„ç®¡ç†è´£ä»»äº¤ç»™äº†è¿™<br>ä¸ª shared_ptr ä¸€æ—¦è¿™æ ·åš äº† ï¼Œ æˆ‘ä»¬å°±ä¸åº”è¯¥å†ä½¿ç”¨å†…ç½®æŒ‡é’ˆæ¥è®¿é—® shared_ptr æ‰€<br>æŒ‡å‘çš„å†…å­˜äº† </p>
<h1 id="ä¸è¦ä½¿ç”¨-get-åˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–ä¸ºæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼"><a href="#ä¸è¦ä½¿ç”¨-get-åˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–ä¸ºæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼" class="headerlink" title="ä¸è¦ä½¿ç”¨ get åˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–ä¸ºæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼"></a>ä¸è¦ä½¿ç”¨ get åˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæˆ–ä¸ºæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼</h1><p>æ™ºèƒ½æŒ‡é’ˆç±»å‹å®šä¹‰äº† ä¸€ä¸ªåä¸º get çš„å‡½æ•°(å‚è§è¡¨ 1 2. J )ï¼Œå®ƒè¿”å›ä¸€ä¸ªå†…ç½®æŒ‡é’ˆï¼Œ<br>æŒ‡å‘æ™ºèƒ½æŒ‡é’ˆç®¡ç†çš„å¯¹è±¡ ã€‚ æ­¤å‡½æ•°æ˜¯ä¸ºäº†è¿™æ ·ä¸€ç§æƒ…å†µè€Œè®¾è®¡çš„ : æˆ‘ä»¬éœ€è¦å‘ä¸èƒ½ä½¿ç”¨æ™º<br>èƒ½æŒ‡é’ˆçš„ä»£ç ä¼ é€’ä¸€ä¸ªå†…ç½®æŒ‡é’ˆã€‚ä½¿ç”¨ get è¿”å›çš„æŒ‡å‘Š| çš„ä»£ç ä¸èƒ½ delete æ­¤æŒ‡é’ˆ ã€‚<br>è™½ç„¶ç¼–è¯‘å™¨ä¸ä¼šç»™å‡ºé”™è¯¯ä¿¡æ¯ ï¼Œ ä½†å°†å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆä¹Ÿç»‘å®šåˆ° get è¿”å›çš„æŒ‡é’ˆä¸Šæ˜¯<br>é”™è¯¯çš„ :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">shared_ptr</span>&lt;<span class="keyword">int</span>&gt; p(<span class="keyword">new</span> <span class="keyword">int</span>(<span class="number">42</span>)) ; <span class="comment">// å¼• ç”¨è®¡æ•°ä¸º 1</span></span><br><span class="line"><span class="keyword">int</span> *q = p . get() ; <span class="comment">// æ­£ç¡® Â· ä½†ä½¿ç”¨ q æ—¶å¦¥æ³¨æ„ï¼Œä¸è¦è®©å®ƒç®¡ç†çš„æŒ‡é’ˆè¢«é‡Šæ”¾</span></span><br><span class="line">&#123; <span class="comment">// æ–°ç¨‹åºå—</span></span><br><span class="line"><span class="comment">// æœªå®šä¹‰:ä¸¤ä¸ªç‹¬ç«‹çš„ shared_ptr æŒ‡ å‘ ç›¸åŒçš„å†…å­˜</span></span><br><span class="line">    shared ptr&lt;<span class="keyword">int</span>&gt; (q) ;</span><br><span class="line">&#125; <span class="comment">// ç¨‹åºå—ç»“æŸï¼Œ q è¢«é”€æ¯ ï¼Œ å®ƒæŒ‡å‘çš„å†…å­˜è¢«å¾…æ”¾</span></span><br><span class="line"><span class="keyword">int</span> foo = *p ; <span class="comment">// æœªå®šä¹‰ p æŒ‡å‘çš„å†…å­˜ å·² ç»è¢«é‡Šæ”¾äº†</span></span><br></pre></td></tr></table></figure>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ p å’Œ q æŒ‡ å‘ç›¸åŒçš„å†…å­˜ã€‚ç”±äºå®ƒä»¬æ˜¯ç›¸äº’ç‹¬ç«‹åˆ›å»ºçš„ï¼Œå› æ­¤å„è‡ªçš„å¼•ç”¨è®¡æ•°éƒ½<br>æ˜¯ 1ã€‚ å½“ q æ‰€åœ¨çš„ç¨‹åºå—ç»“æŸæ—¶ ï¼Œ q è¢«é”€æ¯ ï¼Œ è¿™ä¼šå¯¼è‡´ q æŒ‡å‘çš„å†…å­˜è¢«é‡Šæ”¾ ã€‚ ä»è€Œ p å˜æˆ<br>ä¸€ä¸ªç©ºæ‚¬æŒ‡é’ˆï¼Œæ„å‘³ç€å½“æˆ‘ä»¬è¯•å›¾ä½¿ç”¨ p æ—¶ï¼Œå°†å‘ç”Ÿæœªå®šä¹‰çš„è¡Œä¸º ã€‚ è€Œä¸” ï¼Œ å½“ p è¢«é”€æ¯æ—¶ ï¼Œ<br>è¿™å—å†…å­˜ä¼šè¢«ç¬¬äºŒæ¬¡ delete ã€‚</p>
<p>get ç”¨æ¥å°†æŒ‡é’ˆçš„è®¿é—®æƒé™ä¼ é€’ç»™ä»£ç ï¼Œä½ åªæœ‰åœ¨ç¡®å®šä»£ç ä¸ä¼š get.<br>ç‰¹åˆ«æ˜¯ï¼Œæ°¸è¿œä¸è¦ç”¨ get åˆå§‹åŒ–å¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆ del ete æŒ‡é’ˆæˆ–è€…ä¸ºå¦ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆèµ‹å€¼.</p>

          
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/linux_gcc_atomic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux_gcc_atomic/" itemprop="url">GCCçš„åŸå­æ“ä½œå‡½æ•°</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-04-11T12:26:26+00:00">
                04-11-2015
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          
            <p>linuxæ”¯æŒçš„å“ªäº›æ“ä½œæ˜¯å…·æœ‰åŸå­ç‰¹æ€§çš„ï¼ŸçŸ¥é“è¿™äº›ä¸œè¥¿æ˜¯ç†è§£å’Œè®¾è®¡æ— é”åŒ–ç¼–ç¨‹ç®—æ³•çš„åŸºç¡€ã€‚</p>
<p>ä¸‹é¢çš„ä¸œè¥¿æ•´ç†è‡ªç½‘ç»œã€‚å…ˆæ„Ÿè°¢å¤§å®¶çš„åˆ†äº«ï¼</p>
<h1 id="åŸå­æ“ä½œçš„apiå‡½æ•°"><a href="#åŸå­æ“ä½œçš„apiå‡½æ•°" class="headerlink" title="åŸå­æ“ä½œçš„apiå‡½æ•°"></a>åŸå­æ“ä½œçš„apiå‡½æ•°</h1><p>gccä»4.1.2ä»¥åæä¾›äº† <code>__sync_*</code> ç³»åˆ—çš„ä¸‹é¢å‡ ç±»çš„å†…åµŒå‡½æ•°ï¼Œæä¾›ç”¨äºé’ˆå¯¹æ•°å­—æˆ–å¸ƒå°”å‹å˜é‡çš„åŸå­æ“ä½œã€‚</p>
<h2 id="n-ç±»"><a href="#n-ç±»" class="headerlink" title="n++ç±»"></a>n++ç±»</h2><p>è¿™ç»„è¿”å›æ›´æ–°å‰çš„å€¼</p>
<pre><code>type __sync_fetch_and_add (type *ptr, type value, ...)
type __sync_fetch_and_sub (type *ptr, type value, ...)
type __sync_fetch_and_or (type *ptr, type value, ...)
type __sync_fetch_and_and (type *ptr, type value, ...)
type __sync_fetch_and_xor (type *ptr, type value, ...)
type __sync_fetch_and_nand (type *ptr, type value, ...)
</code></pre><h2 id="nç±»"><a href="#nç±»" class="headerlink" title="++nç±»"></a>++nç±»</h2><p>è¿™ç»„è¿”å›æ›´æ–°åçš„å€¼</p>
<pre><code>type __sync_add_and_fetch (type *ptr, type value, ...)
type __sync_sub_and_fetch (type *ptr, type value, ...)
type __sync_or_and_fetch (type *ptr, type value, ...)
type __sync_and_and_fetch (type *ptr, type value, ...)
type __sync_xor_and_fetch (type *ptr, type value, ...)
type __sync_nand_and_fetch (type *ptr, type value, ...)
</code></pre><p>typeå¯ä»¥æ˜¯1,2,4æˆ–8å­—èŠ‚é•¿åº¦çš„intç±»å‹ï¼Œå³ï¼š</p>
<pre><code>int8_t / uint8_t
int16_t / uint16_t
int32_t / uint32_t
int64_t / uint64_t
</code></pre><p>åé¢çš„å¯æ‰©å±•å‚æ•°(â€¦)ç”¨æ¥æŒ‡å‡ºå“ªäº›å˜é‡éœ€è¦memory barrier,å› ä¸ºç›®å‰gccå®ç°çš„æ˜¯full barrierï¼ˆç±»ä¼¼äºlinux kernel ä¸­çš„mb(),è¡¨ç¤ºè¿™ä¸ªæ“ä½œä¹‹å‰çš„æ‰€æœ‰å†…å­˜æ“ä½œä¸ä¼šè¢«é‡æ’åºåˆ°è¿™ä¸ªæ“ä½œä¹‹åï¼‰,æ‰€ä»¥å¯ä»¥ç•¥æ‰è¿™ä¸ªå‚æ•°ã€‚</p>
<h2 id="CASç±»"><a href="#CASç±»" class="headerlink" title="CASç±»"></a>CASç±»</h2><p>CAS å³ compare-and-swap , </p>
<p>ä¸‹é¢è¿™ä¸¤ä¸ªå‡½æ•°æä¾›åŸå­çš„æ¯”è¾ƒå’Œäº¤æ¢ï¼Œå¦‚æœ <code>*ptr == oldval</code>,å°±å°† <code>newval</code> å†™å…¥ <code>*ptr</code> </p>
<ul>
<li><p>æ­¤å‡½æ•°åœ¨ç›¸ç­‰å¹¶å†™å…¥çš„æƒ…å†µä¸‹è¿”å› true</p>
<pre><code>bool __sync_bool_compare_and_swap (type *ptr, type oldval, type newval, ...)
/* å¯¹åº”çš„ä¼ªä»£ç  */
{ if (*ptr == oldval) { *ptr = newval; return true; } else { return false; } }
</code></pre></li>
</ul>
<ul>
<li><p>æ­¤å‡½æ•°åœ¨è¿”å› <code>oldval</code></p>
<pre><code>type __sync_val_compare_and_swap (type *ptr, type oldval, type newval, ...)
/* å¯¹åº”çš„ä¼ªä»£ç  */
{ if (*ptr == oldval) { *ptr = newval; } return oldval; }
</code></pre></li>
</ul>
<h2 id="å…¶ä»–åŸå­æ“ä½œ"><a href="#å…¶ä»–åŸå­æ“ä½œ" class="headerlink" title="å…¶ä»–åŸå­æ“ä½œ"></a>å…¶ä»–åŸå­æ“ä½œ</h2><pre><code>type __sync_lock_test_and_set (type *ptr, type value, ...)
</code></pre><p>å°†  <code>*ptr</code> è®¾ä¸ºvalueå¹¶è¿”å› <code>*ptr</code> æ“ä½œä¹‹å‰çš„å€¼ã€‚</p>
<pre><code>void __sync_lock_release (type *ptr, ...)
</code></pre><p>å°† <code>*ptr</code> ç½® 0</p>
<h1 id="å†…å­˜æ …éšœ"><a href="#å†…å­˜æ …éšœ" class="headerlink" title="å†…å­˜æ …éšœ"></a>å†…å­˜æ …éšœ</h1><p>å†…å­˜æ …éšœä¸»è¦æ˜¯å¤„ç†ä¸åŒcpuè¿ä½œæ—¶ï¼ˆä¸»è¦æ˜¯æ‰§è¡Œä¸åŒçº¿ç¨‹ä»£ç æ—¶ï¼‰ï¼Œä¸€ä¸ªcpuå¯¹å†…å­˜çš„æ“ä½œçš„åŸå­æ€§ï¼Œä¹Ÿå°±ä¿è¯å…¶ä»–cpuè§åˆ°çš„å†…å­˜å•å…ƒæ•°æ®çš„æ­£ç¡®æ€§ã€‚</p>
<h2 id="å†…å­˜æ …éšœä»‹ç»"><a href="#å†…å­˜æ …éšœä»‹ç»" class="headerlink" title="å†…å­˜æ …éšœä»‹ç»"></a>å†…å­˜æ …éšœä»‹ç»</h2><p>å¦‚æœæœ‰å¯¹æŸä¸€å˜é‡ä¸Šå†™é”ï¼Œ å°±ä¸èƒ½åœ¨ä¸è·å¾—ç›¸åº”çš„é”æ—¶å¯¹å…¶è¿›è¡Œè¯»å–æ“ä½œã€‚<br>å†…å­˜æ …çš„ä½œç”¨åœ¨äºä¿è¯å†…å­˜æ“ä½œçš„ç›¸å¯¹é¡ºåºï¼Œ ä½†å¹¶ä¸ä¿è¯å†…å­˜æ“ä½œçš„ä¸¥æ ¼æ—¶åºã€‚ </p>
<p>å†…å­˜æ …å¹¶ä¸ä¿è¯ CPU å°†æœ¬åœ°å¿«å–ç¼“å­˜æˆ–å­˜å‚¨ç¼“å†²çš„å†…å®¹åˆ·å†™å›å†…å­˜ï¼Œ è€Œæ˜¯åœ¨é”é‡Šæ”¾æ—¶ç¡®ä¿å…¶æ‰€ä¿æŠ¤çš„æ•°æ®ï¼Œ å¯¹äºèƒ½çœ‹åˆ°åˆšé‡Šæ”¾çš„é‚£ä¸ªé”çš„ CPU æˆ–è®¾å¤‡å¯è§ã€‚<br>æŒæœ‰å†…å­˜æ …çš„ CPU å¯ä»¥åœ¨å…¶å¿«å–ç¼“å­˜æˆ–å­˜å‚¨ç¼“å†²ä¸­å°†æ•°æ®ä¿æŒå…¶æ‰€å¸Œæœ›çš„ã€ ä»»æ„é•¿çš„æ—¶é—´ï¼Œ ä½†å¦‚æœå…¶å®ƒ CPU åœ¨åŒä¸€æ•°æ®å…ƒä¸Šæ‰§è¡ŒåŸå­æ“ä½œï¼Œ<br>åˆ™ç¬¬ä¸€ä¸ª CPU å¿…é¡»ä¿è¯ï¼Œ å…¶æ‰€æ›´æ–°çš„æ•°æ®å€¼ï¼Œ ä»¥åŠå†…å­˜æ …æ‰€è¦æ±‚çš„ä»»ä½•å…¶å®ƒæ“ä½œï¼Œ å¯¹ç¬¬äºŒä¸ª CPU å¯è§ã€‚</p>
<pre><code>__sync_synchronize (...)
</code></pre><p>å‘å‡ºä¸€ä¸ªfull barrier.</p>
<h2 id="å†…å­˜æ …éšœåº”ç”¨"><a href="#å†…å­˜æ …éšœåº”ç”¨" class="headerlink" title="å†…å­˜æ …éšœåº”ç”¨"></a>å†…å­˜æ …éšœåº”ç”¨</h2><p>å¯¹äºæ‰§è¡Œä¸€æ¡æŒ‡ä»¤ï¼Œæ“ä½œåˆ°4ä¸ªå¯„å­˜å™¨æ—¶ï¼Œå¦‚ï¼š</p>
<pre><code>write1(dev.register_size,size);
write1(dev.register_addr,addr);
write1(dev.register_cmd,READ);
write1(dev.register_control,GO);
</code></pre><p>æœ€åä¸€ä¸ªå¯„å­˜å™¨æ˜¯æ§åˆ¶å¯„å­˜å™¨ï¼Œåœ¨æ‰€æœ‰çš„å‚æ•°éƒ½è®¾ç½®å¥½ä¹‹åå‘å…¶å‘å‡ºæŒ‡ä»¤ï¼Œè®¾å¤‡å¼€å§‹è¯»å–å‚æ•°.</p>
<p>å¦‚æœæœ€åä¸€æ¡write1è¢«æ¢åˆ°äº†å‰å‡ æ¡è¯­å¥ä¹‹å‰ï¼Œé‚£ä¹ˆè‚¯å®šä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨æœ€åä¸€æ¡è¯­å¥ä¹‹å‰åŠ å…¥ä¸€ä¸ªmemory barrier,å¼ºåˆ¶cpuæ‰§è¡Œå®Œå‰é¢çš„å†™å…¥ä»¥åå†æ‰§è¡Œæœ€åä¸€æ¡ï¼š</p>
<pre><code>write1(dev.register_size,size);
write1(dev.register_addr,addr);
write1(dev.register_cmd,READ);
__sync_synchronize();
write1(dev.register_control,GO);
</code></pre><p>memory barrieræœ‰å‡ ç§ç±»å‹ï¼š</p>
<ul>
<li>acquire barrier : ä¸å…è®¸å°†barrierä¹‹åçš„å†…å­˜è¯»å–æŒ‡ä»¤ç§»åˆ°barrierä¹‹å‰ï¼ˆlinux kernelä¸­çš„wmb()ï¼‰ã€‚</li>
<li>release barrier : ä¸å…è®¸å°†barrierä¹‹å‰çš„å†…å­˜è¯»å–æŒ‡ä»¤ç§»åˆ°barrierä¹‹å (linux kernelä¸­çš„rmb())ã€‚</li>
<li>full barrier    : ä»¥ä¸Šä¸¤ç§barrierçš„åˆé›†(linux kernelä¸­çš„mb())ã€‚</li>
</ul>
<h1 id="åŸå­æ“ä½œåº”ç”¨èŒƒå›´"><a href="#åŸå­æ“ä½œåº”ç”¨èŒƒå›´" class="headerlink" title="åŸå­æ“ä½œåº”ç”¨èŒƒå›´"></a>åŸå­æ“ä½œåº”ç”¨èŒƒå›´</h1><p>åŸå­æ“ä½œåªå…è®¸ä¸€æ¬¡æ›´æ–°æˆ–è¯»ä¸€ä¸ªå†…å­˜å•å…ƒã€‚ éœ€è¦åŸå­åœ°æ›´æ–°å¤šä¸ªå•å…ƒæ—¶ï¼Œ å°±å¿…é¡»ä½¿ç”¨é”æ¥ä»£æ›¿å®ƒäº†ã€‚ </p>
<p>ä¾‹å¦‚ï¼Œ å¦‚æœéœ€è¦æ›´æ–°ä¸¤ä¸ªç›¸äº’å…³è”çš„è®¡æ•°å™¨æ—¶ï¼Œ å°±å¿…é¡»ä½¿ç”¨é”ï¼Œ è€Œä¸æ˜¯ä¸¤æ¬¡å•ç‹¬çš„åŸå­æ“ä½œäº†ã€‚</p>
<h1 id="åŸå­æ“ä½œä¾‹å­"><a href="#åŸå­æ“ä½œä¾‹å­" class="headerlink" title="åŸå­æ“ä½œä¾‹å­"></a>åŸå­æ“ä½œä¾‹å­</h1><p>ä¾‹å­ä»£ç ï¼š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;  </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;  </span></span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">0</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">test_func</span><span class="params">(<span class="keyword">void</span> *arg)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">        <span class="keyword">int</span> i=<span class="number">0</span>;  </span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">20000</span>;++i)&#123;  </span><br><span class="line">                __sync_fetch_and_add(&amp;count,<span class="number">1</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> *argv[])</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">        <span class="keyword">pthread_t</span> id[<span class="number">20</span>];  </span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">20</span>;++i)&#123;  </span><br><span class="line">                pthread_create(&amp;id[i],<span class="literal">NULL</span>,test_func,<span class="literal">NULL</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">20</span>;++i)&#123;  </span><br><span class="line">                pthread_join(id[i],<span class="literal">NULL</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,count);  </span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="åŸå­æ“ä½œå°è£…ä½¿ç”¨"><a href="#åŸå­æ“ä½œå°è£…ä½¿ç”¨" class="headerlink" title="åŸå­æ“ä½œå°è£…ä½¿ç”¨"></a>åŸå­æ“ä½œå°è£…ä½¿ç”¨</h1><p>æ ¹æ®å¸¸ç”¨çš„åŸå­æ“ä½œï¼Œå°è£…ä¸€äº›å®ç”¨çš„æ¥å£ :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŸå­æ“ä½œ  </span></span><br><span class="line"><span class="comment">//è®¾ç½®å€¼  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lock_set</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">int</span> &amp;a, <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    __sync_val_compare_and_swap(&amp;a, a, value);  </span><br><span class="line">    <span class="keyword">return</span> a;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//åŠ 1  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lock_inc</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">int</span> &amp;n)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_add(&amp;n, <span class="number">1</span>);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">//å‡1  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lock_dec</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">int</span> &amp;n)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_sub(&amp;n, <span class="number">1</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//åŠ å€¼value  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lock_add</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">int</span> &amp;n, <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_add(&amp;n, value);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//å‡å€¼value  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lock_sub</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">int</span> &amp;n, <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_sub(&amp;n, value);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//ä½æˆ–value  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lock_or</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">int</span> &amp;n, <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_or(&amp;n, value);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//ä½ä¸value  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lock_and</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">int</span> &amp;n, <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_and(&amp;n, value);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//å¼‚æˆ–value  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lock_xor</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">int</span> &amp;n, <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_xor(&amp;n, value);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//æ— ç¬¦å·ç±»å‹ï¼ˆå‡½æ•°é‡è½½ï¼‰  </span></span><br><span class="line"><span class="comment">//è®¾ç½®å€¼  </span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">lock_set</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> &amp;a, <span class="keyword">unsigned</span> <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    __sync_val_compare_and_swap(&amp;a, a, value);  </span><br><span class="line">    <span class="keyword">return</span> a;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//åŠ 1  </span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">lock_inc</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> &amp;n)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_add(&amp;n, <span class="number">1</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//å‡1  </span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">lock_dec</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> &amp;n)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_sub(&amp;n, <span class="number">1</span>);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//åŠ å€¼value  </span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">lock_add</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> &amp;n, <span class="keyword">unsigned</span> <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_add((<span class="keyword">int</span>*)&amp;n, value);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//å‡å€¼value  </span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">lock_sub</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> &amp;n, <span class="keyword">unsigned</span> <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_sub((<span class="keyword">int</span>*)&amp;n, value);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//ä½æˆ–value  </span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">lock_or</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> &amp;n, <span class="keyword">unsigned</span> <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_or((<span class="keyword">int</span>*)&amp;n, value);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//ä½ä¸value  </span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">lock_and</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> &amp;n, <span class="keyword">unsigned</span> <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_and((<span class="keyword">int</span>*)&amp;n, value);  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//å¼‚æˆ–value  </span></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">lock_xor</span><span class="params">(<span class="keyword">volatile</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> &amp;n, <span class="keyword">unsigned</span> <span class="keyword">int</span> value)</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> __sync_fetch_and_xor((<span class="keyword">int</span>*)&amp;n, value);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/linux_directory_permission/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux_directory_permission/" itemprop="url">linuxä¸€äº›ä¸è¦æƒ³å½“ç„¶çš„äº‹(ä¸€)ä¹‹ç›®å½•æƒé™</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-18T17:11:52+00:00">
                03-18-2015
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          <h1 id="ç›®å½•çš„å¯è¯»-å¯å†™-å¯æ‰§è¡Œæƒé™"><a href="#ç›®å½•çš„å¯è¯»-å¯å†™-å¯æ‰§è¡Œæƒé™" class="headerlink" title="ç›®å½•çš„å¯è¯»/å¯å†™/å¯æ‰§è¡Œæƒé™"></a>ç›®å½•çš„å¯è¯»/å¯å†™/å¯æ‰§è¡Œæƒé™</h1><p>ä¸è¦æŠŠç›®å½•çš„è¿™å‡ ä¸ªæƒé™å’Œæ¡£æ¡ˆçš„è¿™å‡ ä¸ªæƒé™æ··æ·†äº†, ä¸è¦æƒ³å½“ç„¶çš„ä»¥ä¸ºæ˜¯å·®ä¸å¤šçš„, å·®å¾ˆå¤š!<br>è®°å¿†æŠ€å·§ : <strong>æ¡£æ¡ˆçš„rwxæ˜¯é’ˆå¯¹äºæ¡£æ¡ˆçš„å†…å®¹æ¥è®¾è®¡çš„, è€Œç›®å½•çš„rwxæ˜¯é’ˆå¯¹äºç›®å½•çš„æ–‡ä»¶ååˆ—è¡¨æ¥è®¾è®¡çš„</strong></p>
<p><strong>. . .</strong>
          <!--noindex-->
          
          <!--/noindex-->
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </p></div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/linux_command_df_free_top/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux_command_df_free_top/" itemprop="url">Linuxå¸¸ç”¨è¿ç»´å‘½ä»¤(dfå’Œfreeå’Œtop)ç¬”è®°æ•´ç†(ä¸‰)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-11T12:16:56+00:00">
                03-11-2015
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          <h1 id="df"><a href="#df" class="headerlink" title="df"></a><strong>df</strong></h1><blockquote>
<p>dfå‘½ä»¤ç”¨äºæ˜¾ç¤ºç£ç›˜åˆ†åŒºä¸Šçš„å¯ä½¿ç”¨çš„ç£ç›˜ç©ºé—´ã€‚é»˜è®¤æ˜¾ç¤ºå•ä½ä¸ºKBã€‚å¯ä»¥åˆ©ç”¨è¯¥å‘½ä»¤æ¥è·å–ç¡¬ç›˜è¢«å ç”¨äº†å¤šå°‘ç©ºé—´ï¼Œç›®å‰è¿˜å‰©ä¸‹å¤šå°‘ç©ºé—´ç­‰ä¿¡æ¯ã€‚</p>
</blockquote>
<ul>
<li>-aæˆ–â€“allï¼šåŒ…å«å…¨éƒ¨çš„æ–‡ä»¶ç³»ç»Ÿï¼›</li>
<li>â€“block-size=&lt;åŒºå—å¤§å°&gt;ï¼šä»¥æŒ‡å®šçš„åŒºå—å¤§å°æ¥æ˜¾ç¤ºåŒºå—æ•°ç›®ï¼›</li>
<li>-hæˆ–â€“human-readableï¼šä»¥å¯è¯»æ€§è¾ƒé«˜çš„æ–¹å¼æ¥æ˜¾ç¤ºä¿¡æ¯ï¼›</li>
<li>-Hæˆ–â€“siï¼šä¸-hå‚æ•°ç›¸åŒï¼Œä½†åœ¨è®¡ç®—æ—¶æ˜¯ä»¥1000 Bytesä¸ºæ¢ç®—å•ä½è€Œé1024 Bytesï¼›</li>
<li>-iæˆ–â€“inodesï¼šæ˜¾ç¤ºinodeçš„ä¿¡æ¯ï¼›</li>
<li>-kæˆ–â€“kilobytesï¼šæŒ‡å®šåŒºå—å¤§å°ä¸º1024å­—èŠ‚ï¼›</li>
<li>-læˆ–â€“localï¼šä»…æ˜¾ç¤ºæœ¬åœ°ç«¯çš„æ–‡ä»¶ç³»ç»Ÿï¼›</li>
<li>-mæˆ–â€“megabytesï¼šæŒ‡å®šåŒºå—å¤§å°ä¸º1048576å­—èŠ‚ï¼›</li>
<li>â€“no-syncï¼šåœ¨å–å¾—ç£ç›˜ä½¿ç”¨ä¿¡æ¯å‰ï¼Œä¸è¦æ‰§è¡ŒsyncæŒ‡ä»¤ï¼Œæ­¤ä¸ºé¢„è®¾å€¼ï¼›</li>
<li>-Pæˆ–â€“portabilityï¼šä½¿ç”¨POSIXçš„è¾“å‡ºæ ¼å¼ï¼›</li>
<li>â€“syncï¼šåœ¨å–å¾—ç£ç›˜ä½¿ç”¨ä¿¡æ¯å‰ï¼Œå…ˆæ‰§è¡ŒsyncæŒ‡ä»¤ï¼›</li>
<li>-t&lt;æ–‡ä»¶ç³»ç»Ÿç±»å‹&gt;æˆ–â€“type=&lt;æ–‡ä»¶ç³»ç»Ÿç±»å‹&gt;ï¼šä»…æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹çš„ç£ç›˜ä¿¡æ¯ï¼›</li>
<li>-Tæˆ–â€“print-typeï¼šæ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹ï¼›</li>
<li>-x&lt;æ–‡ä»¶ç³»ç»Ÿç±»å‹&gt;æˆ–â€“exclude-type=&lt;æ–‡ä»¶ç³»ç»Ÿç±»å‹&gt;ï¼šä¸è¦æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹çš„ç£ç›˜ä¿¡æ¯ï¼›</li>
<li>â€“helpï¼šæ˜¾ç¤ºå¸®åŠ©ï¼›</li>
<li>â€“versionï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯</li>
</ul>
<p><strong>. . .</strong>
          <!--noindex-->
          
          <!--/noindex-->
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </p></div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/linux_command_netstat_lsof/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux_command_netstat_lsof/" itemprop="url">Linuxå¸¸ç”¨è¿ç»´å‘½ä»¤(netstatå’Œlsof)ç¬”è®°æ•´ç†(äºŒ)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-09T23:16:16+00:00">
                03-09-2015
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          <h1 id="netstat"><a href="#netstat" class="headerlink" title="netstat"></a>netstat</h1><blockquote>
<p>netstatå‘½ä»¤ç”¨æ¥æ‰“å°Linuxä¸­ç½‘ç»œç³»ç»Ÿçš„çŠ¶æ€ä¿¡æ¯ï¼Œå¯è®©ä½ å¾—çŸ¥æ•´ä¸ªLinuxç³»ç»Ÿçš„ç½‘ç»œæƒ…å†µã€‚</p>
</blockquote>
<ul>
<li>-<strong>aæˆ–â€“allï¼šæ˜¾ç¤ºæ‰€æœ‰è¿çº¿ä¸­çš„Socketï¼›</strong></li>
<li>-A&lt;ç½‘ç»œç±»å‹&gt;æˆ–â€“&lt;ç½‘ç»œç±»å‹&gt;ï¼šåˆ—å‡ºè¯¥ç½‘ç»œç±»å‹è¿çº¿ä¸­çš„ç›¸å…³åœ°å€ï¼›</li>
<li>-cæˆ–â€“continuousï¼šæŒç»­åˆ—å‡ºç½‘ç»œçŠ¶æ€ï¼›</li>
<li>-Cæˆ–â€“cacheï¼šæ˜¾ç¤ºè·¯ç”±å™¨é…ç½®çš„å¿«å–ä¿¡æ¯ï¼›</li>
<li>-eæˆ–â€“extendï¼šæ˜¾ç¤ºç½‘ç»œå…¶ä»–ç›¸å…³ä¿¡æ¯ï¼›</li>
<li>-Fæˆ–â€“fibï¼šæ˜¾ç¤ºFIBï¼›</li>
<li>-gæˆ–â€“groupsï¼šæ˜¾ç¤ºå¤šé‡å¹¿æ’­åŠŸèƒ½ç¾¤ç»„ç»„å‘˜åå•ï¼›</li>
<li>-hæˆ–â€“helpï¼šåœ¨çº¿å¸®åŠ©ï¼›</li>
<li>-iæˆ–â€“interfacesï¼šæ˜¾ç¤ºç½‘ç»œç•Œé¢ä¿¡æ¯è¡¨å•ï¼›</li>
<li>-<strong>læˆ–â€“listeningï¼šæ˜¾ç¤ºç›‘æ§ä¸­çš„æœåŠ¡å™¨çš„Socketï¼›</strong></li>
<li>-Mæˆ–â€“masqueradeï¼šæ˜¾ç¤ºä¼ªè£…çš„ç½‘ç»œè¿çº¿ï¼›</li>
<li>-<strong>næˆ–â€“numericï¼šç›´æ¥ä½¿ç”¨ipåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨ï¼›</strong></li>
<li>-Næˆ–â€“netlinkæˆ–â€“symbolicï¼šæ˜¾ç¤ºç½‘ç»œç¡¬ä»¶å¤–å›´è®¾å¤‡çš„ç¬¦å·è¿æ¥åç§°ï¼›</li>
<li>-oæˆ–â€“timersï¼šæ˜¾ç¤ºè®¡æ—¶å™¨ï¼›</li>
<li>-<strong>pæˆ–â€“programsï¼šæ˜¾ç¤ºæ­£åœ¨ä½¿ç”¨Socketçš„ç¨‹åºè¯†åˆ«ç å’Œç¨‹åºåç§°ï¼›</strong></li>
<li>-ræˆ–â€“routeï¼šæ˜¾ç¤ºRouting Tableï¼›</li>
<li>-sæˆ–â€“statisticeï¼šæ˜¾ç¤ºç½‘ç»œå·¥ä½œä¿¡æ¯ç»Ÿè®¡è¡¨ï¼›</li>
<li>-tæˆ–â€“tcpï¼šæ˜¾ç¤ºTCPä¼ è¾“åè®®çš„è¿çº¿çŠ¶å†µï¼›</li>
<li>-uæˆ–â€“udpï¼šæ˜¾ç¤ºUDPä¼ è¾“åè®®çš„è¿çº¿çŠ¶å†µï¼›</li>
<li>-væˆ–â€“verboseï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼›</li>
<li>-Væˆ–â€“versionï¼šæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ï¼›</li>
<li>-wæˆ–â€“rawï¼šæ˜¾ç¤ºRAWä¼ è¾“åè®®çš„è¿çº¿çŠ¶å†µï¼›</li>
<li>-xæˆ–â€“unixï¼šæ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®šâ€-A unixâ€å‚æ•°ç›¸åŒï¼›</li>
<li>â€“ipæˆ–â€“inetï¼šæ­¤å‚æ•°çš„æ•ˆæœå’ŒæŒ‡å®šâ€-A inetâ€å‚æ•°ç›¸åŒã€‚</li>
</ul>
<p><strong>. . .</strong>
          <!--noindex-->
          
          <!--/noindex-->
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </p></div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/linux_command_iostat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/linux_command_iostat/" itemprop="url">Linuxå¸¸ç”¨è¿ç»´å‘½ä»¤(iostat)ç¬”è®°æ•´ç†(ä¸€)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-07T19:46:26+00:00">
                03-07-2015
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          <p>åœ¨linuxæœåŠ¡å™¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œ ç»å¸¸éœ€è¦å„ç§å‘½ä»¤é…åˆæ¥æŸ¥çœ‹å„ç§çŠ¶æ€ï¼Œæ‰€ä»¥æ•´ç†äº†ä¸€äº›è€çš„ç¬”è®°æ¥å¤‡å¿˜ã€‚</p>
<h1 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a><strong>iostat</strong></h1><blockquote>
<p>iostatä¸»è¦ç”¨äºç›‘æ§ç³»ç»Ÿè®¾å¤‡çš„IOè´Ÿè½½æƒ…å†µï¼Œiostaté¦–æ¬¡è¿è¡Œæ—¶æ˜¾ç¤ºè‡ªç³»ç»Ÿå¯åŠ¨å¼€å§‹çš„å„é¡¹ç»Ÿè®¡ä¿¡æ¯ï¼Œä¹‹åè¿è¡Œiostatå°†æ˜¾ç¤ºè‡ªä¸Šæ¬¡è¿è¡Œè¯¥å‘½ä»¤ä»¥åçš„ç»Ÿè®¡ä¿¡æ¯ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æŒ‡å®šç»Ÿè®¡çš„æ¬¡æ•°å’Œæ—¶é—´æ¥è·å¾—æ‰€éœ€çš„ç»Ÿè®¡ä¿¡æ¯</p>
</blockquote>
<ul>
<li>-c ä»…æ˜¾ç¤ºCPUç»Ÿè®¡ä¿¡æ¯.ä¸-dé€‰é¡¹äº’æ–¥.</li>
<li>-d ä»…æ˜¾ç¤ºç£ç›˜ç»Ÿè®¡ä¿¡æ¯.ä¸-cé€‰é¡¹äº’æ–¥.</li>
<li>-k ä»¥Kä¸ºå•ä½æ˜¾ç¤ºæ¯ç§’çš„ç£ç›˜è¯·æ±‚æ•°,é»˜è®¤å•ä½å—.</li>
<li>-t  åœ¨è¾“å‡ºæ•°æ®æ—¶,æ‰“å°æœé›†æ•°æ®çš„æ—¶é—´.</li>
<li>-V æ‰“å°ç‰ˆæœ¬å·å’Œå¸®åŠ©ä¿¡æ¯.</li>
<li>-x  è¾“å‡ºæ‰©å±•ä¿¡æ¯.</li>
</ul>
<p><strong>. . .</strong>
          <!--noindex-->
          
          <!--/noindex-->
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </p></div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
      
        

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hulinhong.com/pythonçš„structæ¨¡å—/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mike">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ğŸš™">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/pythonçš„structæ¨¡å—/" itemprop="url">pythonçš„structæ¨¡å—</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-02T21:49:19+00:00">
                03-02-2015
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Misc/" itemprop="url" rel="index">
                    <span itemprop="name">Misc</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    




    
    
    
    <div class="post-body" itemprop="articleBody">
      
      

      

      
      
        <div class="post-eof"></div>
      

      
      

      
        
          
            <blockquote>
<p>struct, è¿™ç©æ„c/c++ä¹Ÿæœ‰, é¡¾åæ€ä¹‰, èƒ½è”æƒ³åˆ°è¿™ç©æ„æ˜¯å•¥äº†</p>
</blockquote>
<p>æ¨¡å—çš„ä¸»è¦ä½œç”¨å°±æ˜¯å¯¹pythonåŸºæœ¬ç±»å‹å€¼ä¸</p>
<p>ç”¨pythonå­—ç¬¦ä¸²æ ¼å¼è¡¨ç¤ºçš„C structç±»å‹é—´</p>
<p>çš„è½¬åŒ–ï¼ˆThis module performs conversions between Python values and C structs represented as Python strings.ï¼‰</p>
<h2 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" class="headerlink" title="åŸºæœ¬ç”¨æ³•"></a>åŸºæœ¬ç”¨æ³•</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">values = (<span class="number">1</span>, <span class="string">'abc'</span>, <span class="number">2.7</span>)</span><br><span class="line">s = struct.Struct(<span class="string">'I3sf'</span>)</span><br><span class="line">packed_data = s.pack(*values)</span><br><span class="line">unpacked_data = s.unpack(packed_data)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">print</span> <span class="string">'Original values:'</span>, values</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Format string :'</span>, s.format</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Uses :'</span>, s.size, <span class="string">'bytes'</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Packed Value :'</span>, binascii.hexlify(packed_data)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Unpacked Type :'</span>, type(unpacked_data), <span class="string">' Value:'</span>, unpacked_data</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºä¸º:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Original values: (1, &apos;abc&apos;, 2.7) </span><br><span class="line">Format string : I3sf </span><br><span class="line">Uses : 12 bytes </span><br><span class="line">Packed Value : 0100000061626300cdcc2c40 </span><br><span class="line">Unpacked Type : &lt;type &apos;tuple&apos;&gt;  Value: (1, &apos;abc&apos;, 2.700000047683716)</span><br></pre></td></tr></table></figure></p>
<p>ä»£ç ä¸­ï¼Œ</p>
<p>é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªå…ƒç»„æ•°æ®ï¼Œ</p>
<p>åŒ…å«intã€stringã€floatä¸‰ç§æ•°æ®ç±»å‹ï¼Œ</p>
<p>ç„¶åå®šä¹‰äº†structå¯¹è±¡ï¼Œå¹¶åˆ¶å®šäº†formatâ€˜I3sfâ€™ï¼Œ</p>
<ul>
<li><p>I è¡¨ç¤ºintï¼Œ</p>
</li>
<li><p>3sè¡¨ç¤ºä¸‰ä¸ªå­—ç¬¦é•¿åº¦çš„å­—ç¬¦ä¸²ï¼Œ</p>
</li>
<li><p>f è¡¨ç¤º floatã€‚æœ€åé€šè¿‡structçš„packå’Œunpackè¿›è¡Œæ‰“åŒ…å’Œè§£åŒ…ã€‚é€šè¿‡è¾“å‡ºç»“æœå¯ä»¥å‘ç°ï¼Œ</p>
</li>
</ul>
<p>valueè¢«packä¹‹åï¼Œ</p>
<p>è½¬åŒ–ä¸ºäº†ä¸€æ®µäºŒè¿›åˆ¶å­—èŠ‚ä¸²ï¼Œ</p>
<p>è€Œunpackå¯ä»¥æŠŠè¯¥å­—èŠ‚ä¸²å†è½¬æ¢å›ä¸€ä¸ªå…ƒç»„ï¼Œ</p>
<p>ä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯å¯¹äºfloatçš„ç²¾åº¦å‘ç”Ÿäº†æ”¹å˜ï¼Œ</p>
<p>è¿™æ˜¯ç”±ä¸€äº›æ¯”å¦‚æ“ä½œç³»ç»Ÿç­‰å®¢è§‚å› ç´ æ‰€å†³å®šçš„ã€‚æ‰“åŒ…ä¹‹åçš„æ•°æ®æ‰€å ç”¨çš„å­—èŠ‚æ•°ä¸Cè¯­è¨€ä¸­çš„structååˆ†ç›¸ä¼¼ã€‚å®šä¹‰formatå¯ä»¥å‚ç…§å®˜æ–¹apiæä¾›çš„å¯¹ç…§è¡¨ï¼š</p>
<img src="/pythonçš„structæ¨¡å—/py_struct1.png">
<h2 id="å­—èŠ‚åºè®¾ç½®"><a href="#å­—èŠ‚åºè®¾ç½®" class="headerlink" title="å­—èŠ‚åºè®¾ç½®"></a>å­—èŠ‚åºè®¾ç½®</h2><p>å¦ä¸€æ–¹é¢ï¼Œæ‰“åŒ…çš„åçš„å­—èŠ‚é¡ºåºé»˜è®¤ä¸Šæ˜¯ç”±æ“ä½œç³»ç»Ÿçš„å†³å®šçš„ï¼Œ</p>
<p>å½“ç„¶structæ¨¡å—ä¹Ÿæä¾›äº†è‡ªå®šä¹‰å­—èŠ‚é¡ºåºçš„åŠŸèƒ½ï¼Œ</p>
<p>å¯ä»¥æŒ‡å®šå¤§ç«¯å­˜å‚¨ã€å°ç«¯å­˜å‚¨ç­‰ç‰¹å®šçš„å­—èŠ‚é¡ºåºï¼Œ</p>
<p>å¯¹äºåº•å±‚é€šä¿¡çš„å­—èŠ‚é¡ºåºæ˜¯ååˆ†é‡è¦çš„ï¼Œ</p>
<p>ä¸åŒçš„å­—èŠ‚é¡ºåºå’Œå­˜å‚¨æ–¹å¼ä¹Ÿä¼šå¯¼è‡´å­—èŠ‚å¤§å°çš„ä¸åŒã€‚åœ¨formatå­—ç¬¦ä¸²å‰é¢åŠ ä¸Šç‰¹å®šçš„ç¬¦å·å³å¯ä»¥è¡¨ç¤ºä¸åŒçš„å­—èŠ‚é¡ºåºå­˜å‚¨æ–¹å¼ï¼Œ</p>
<p>ä¾‹å¦‚é‡‡ç”¨å°ç«¯å­˜å‚¨ s = struct.Struct(â€˜&lt;I3sfâ€™)å°±å¯ä»¥äº†ã€‚å®˜æ–¹api library ä¹Ÿæä¾›äº†ç›¸åº”çš„å¯¹ç…§åˆ—è¡¨ï¼š</p>
<img src="/pythonçš„structæ¨¡å—/py_struct2.png">
          
        
      


      

    
      <footer class="post-footer">
        

        

        

        
        
          <div class="post-eof"></div>
        
      </footer>
      
    </div>
    
    
    

    

    

    

  </div>
  
  
  
  </article>


      
    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/30/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><a class="page-number" href="/page/25/">25</a><a class="page-number" href="/page/26/">26</a><a class="page-number" href="/page/27/">27</a><a class="page-number" href="/page/28/">28</a><a class="page-number" href="/page/29/">29</a><a class="page-number" href="/page/30/">30</a><span class="page-number current">31</span><a class="page-number" href="/page/32/">32</a><a class="page-number" href="/page/33/">33</a><a class="page-number" href="/page/34/">34</a><a class="page-number" href="/page/35/">35</a><a class="page-number" href="/page/36/">36</a><a class="extend next" rel="next" href="/page/32/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  

  <aside id="sidebar" class="sidebar">

    
      
        <div id="sidebar-dimmer"></div>
      
    

    <div class="sidebar-inner">
    
      <div class="sidebar-toggle-inside motion-element">
        <div class="sidebar-toggle-line-wrap">
          <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
          <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
        </div>
      </div>

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <a href="/" class="site-author-image" rel="start" style="border:none">
            <img class="site-author-image" itemprop="image" src="/uploads/avatar.png" alt="Mike">
          </a>
          <p class="site-author-name" itemprop="name">Mike</p>
           
              <p class="site-description motion-element" itemprop="description">ğŸš™ ğŸš— ğŸ’¨ ğŸ’¨ If you want to create a blog like this, just follow my open-source project, "hexo-theme-neo", click the GitHub button below and check it out ^_^ . It is recommended to use Chrome, Safari, or Edge to read this blog since this blog was developed on Edge (Chromium kernel version) and tested on Safari.</p>
          
        </div>

        <nav class="site-state motion-element">

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">283</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">105</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

          <div class="site-state-item site-state-about">
            <a href="/about/">
              <span class="site-state-item-about fa fa-fw fa-user"></span>
              <span class="site-state-item-name">about</span>
            </a>
          </div>
          
        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/no5ix" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://open.spotify.com/user/313duq77ekebrfyak3xijqewzss4?si=e7653b829a9747bf" target="_blank" title="Spotify">
                  
                    <i class="fa fa-fw fa-spotify"></i>
                  
                    
                      Spotify
                    
                </a>
              </span>
            
          
          
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->
            <!-- <div class="netease-cloud-music"> -->
              <!-- <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=110 src="//music.163.com/outchain/player?type=0&id=992743594&auto=0&height=90"></iframe> -->
            <!-- </div> -->
          <!-- ç½‘æ˜“äº‘éŸ³ä¹ -->

        </div>

        
        

        
        

        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mike</span>
</div>



        

        
      </div>
    </footer>

    <!--
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      
        <span id="scrollpercent"><span>0</span>%</span>
      
    </div>
    -->

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>











  















  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/mediumzoom/medium-zoom.js?v=1.1.0"></script>




  




  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>


  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

    <script src="/js/src/local-search.js"></script>





  

  

  

  

  

  


  <script type="text/javascript" src="/lib/wobble_window/wobblewindow.js"> </script>
<script type="text/javascript" src="/js/src/custom.js"></script>
</body>
</html>






<script type="text/javascript" src="/js/src/headroom.js"></script> 

<!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ -->
<script type="text/javascript" src="/js/src/code-highlight-modification.js"></script>
